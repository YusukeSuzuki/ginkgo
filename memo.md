用語
================================================================================

名前はそのうち変える

- prophet : 盤面判定
  - 相手の手番の盤面について自分の勝ちか相手の勝ちかを学習する
- enforcer : 手決定
  - 自分の手番の盤面について prophet から合格を得る手を学習する

入出力
================================================================================

## 入力形式

コードを参照すること。同じ shape について prophet は相手手番とみなし enforcer は自分手番とみなす。
自身が後手であっても自分が下から攻める形に整形して入力する。

- shape : [148,9,9]
- レイヤー
  - [配置レイヤー, 合法動きレイヤー] * 駒数
  - 駒数は先手後手合算
  - 駒と駒順 : k*2, r*2, +r*2, b*2, +b*2, g*4, s*4, +s*4, n*4, +n*4, l*4, +l*4, p*18, +p*18
  - 自分駒とその動きは対応位置に1が当てられる。相手駒とその動きは対応位置に-1が当てられる。
  - 駒がない位置、動けない位置には0が当てられる。

## 出力形式

- prophet
  - 入力盤面に対する自身の勝敗予測
  - out = [2]
  - out[0] : 自身の勝敗, 1:win, 0:lose
  - out[1] : 相手の勝敗, 1:win, 0:lose
- enforcer
  - 入力盤面に対する次の自身の手
  - 入力形式から配置レイヤーを除いた形式
    - [74,9,9]
    - 相手玉は手駒にできないが計算の簡便のためレイヤーに含める
  - 教師データとしては手候補の位置に正の実数、そうでない位置に0以下の実数を当てる
  - 手の決定はargmaxで行う
    - to位置 : 出力の位置
    - from位置 : 出力レイヤーに対応する入力レイヤーの配置レイヤーに存在する非ゼロの位置

create 3 pairs of prophet/enforcer
================================================================================

- pair_a = prophet_a and enforcer_a
- pair_b = prophet_b and enforcer_b
- pair_c = prophet_c and enforcer_c

training plan(prophet pre train)
================================================================================

- 1st stage
  - 既存棋譜の各手を自分視点と見て盤面と勝敗の対応を学習する
    - ロスは（手数/総手数）で適当に重み付けする。終盤ほど重視する。

training plan(enforcer pre train)
================================================================================

- 1st stage
  - 自分の手番の盤面について合法な手の集合を出力することを学習する
- 2nd stage
  - 既存棋譜の勝者視点を学習する
  - 自分の手番の盤面について棋譜が指した位置との差をロスとする

training plan(prophet/enforcer)
================================================================================

3つのペアを順繰りで対戦させていく
(先手,後手) in [(a,b), (b,c), (c,a), (b,a), (c,b), (a,c)]

- prophet が合格を出すまで
  - 自分の手番の盤面について enforcer が次手候補を算出する
    - 出力層で正の位置を値順に取り出す
  − 次手を指したあとの盤面について prophet が勝敗判定をする
  - prophet が勝利判定を出した手を実際に次に指す手とする

